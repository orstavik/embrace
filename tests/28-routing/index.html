<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>28 - Routing Demo</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --accent: #38bdf8;
            --border: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        nav {
            background: #1e293b;
            padding: 20px 40px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        nav .links {
            display: flex;
            gap: 20px;
        }

        nav a {
            color: #94a3b8;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        nav a:hover,
        nav a.active {
            color: var(--accent);
        }

        main {
            flex: 1;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .page {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            color: var(--accent);
            font-style: italic;
        }
    </style>
</head>

<body>
    <nav>
        <div class="logo">EmbraceRouter</div>
        <div class="links">
            <a href="#/" id="nav-home">Home</a>
            <a href="#/about" id="nav-about">About</a>
        </div>
    </nav>

    <main id="view">
        <div class="loading">Loading router...</div>
    </main>

    <script type="module">
        import { embrace } from "../../src/v25x.js";

        let appData = {};
        const viewRoot = document.getElementById('view');

        const routes = {
            '/': './pages/home.html',
            '/about': './pages/about.html'
        };

        async function fetchTemplate(url) {
            console.log(url);
            const resp = await fetch(url);
            const html = await resp.text();
            return html;
        }

        async function router() {
            console.log('router');
            let path = window.location.hash.slice(1) || '/';
            const templateUrl = routes[path] || routes['/'];

            // Update active nav links
            document.querySelectorAll('nav a').forEach(a => {
                a.classList.toggle('active', a.getAttribute('href') === `#${path}`);
            });

            viewRoot.innerHTML = '<div class="loading">Loading page...</div>';

            try {
                const template = await fetchTemplate(templateUrl);
                console.log(template);

                // CRITICAL: Clear existing embrace state to allow re-render on the same element
                delete viewRoot.__embrace;
                viewRoot.innerHTML = template;
                console.log(viewRoot);
                embrace(viewRoot, appData);
            } catch (err) {
                viewRoot.innerHTML = `<div style="color: #ef4444">Error loading page: ${err.message}</div>`;
            }
        }

        async function init() {
            console.log('init');
            const resp = await fetch('./data.json');
            appData = await resp.json();

            window.addEventListener('hashchange', router);
            router(); // Initial route
        }

        init();
    </script>
</body>

</html>