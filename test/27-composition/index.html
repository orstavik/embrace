<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>27 - Multi-file Composition</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #f1f5f9;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex: 1;
            padding: 60px 40px;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        h1 {
            color: #38bdf8;
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .desc {
            color: #94a3b8;
            font-size: 1.25rem;
        }
    </style>
</head>

<body>

    <div id="app">
        <div id="header"></div>
        <!--:: ; -->
        <main id="main">
            <h1>${$.content.title}</h1>
            <p class="desc">${$.content.description}</p>
            <div
                style="margin-top: 40px; padding: 20px; background: #1e293b; border-radius: 12px; border: 1px dashed #334155;">
                This central area is rendered from the template inside <code>index.html</code>.
            </div>
        </main>
        <!--:: -->
        <div id="footer"></div>
    </div>

    <!-- The compiled template code will be injected here by compile() -->
    <script type="module" src="/src/DDauto.js"></script>
    <script type="module">
        import { renderUnder, getDefinitions } from "/src/DDrender.js";
        import { register } from "/src/DD.js";
        import { compileString } from "/src/DDcompile.js";

        while (!Object.keys(getDefinitions()).length)
            await new Promise(requestAnimationFrame);

        // 1. Data
        const data = {
            "siteName": "Embrace Framework",
            "userName": "Lojith",
            "year": 2026,
            "nav": [
                "Home",
                "Components",
                "Docs",
                "About"
            ],
            "content": {
                "title": "Module Composition",
                "description": "This page is built from three separate HTML files bound together at runtime."
            }
        };

        async function init() {
            const headerTxt = await (await fetch('./header.html?t=' + Date.now())).text();
            const footerTxt = await (await fetch('./footer.html?t=' + Date.now())).text();

            const motherScript = document.createElement("script");
            motherScript.type = "module";
            motherScript.src = "/src/DDCompile.js";
            const header = compileString(headerTxt, motherScript);
            const footer = compileString(footerTxt, motherScript);
            document.head.appendChild(motherScript);
            for (let t of header.reverse()) register(t);
            for (let t of footer.reverse()) register(t);
            document.getElementById('header').innerHTML = `<!--:: ${header.at(-1).id}--><!--::-->`;
            document.getElementById('footer').innerHTML = `<!--:: ${footer.at(-1).id}--><!--::-->`;

            renderUnder(document.getElementById("app"), data);
        }

        init();
    </script>
</body>

</html>