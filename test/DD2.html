<h1>hello</h1>
<!--:: if($.header)  -->
<h2 alice="${$.bob.join(',')}">hello ${$.sunshine}</h2>
<h2>hello ${$.world}</h2>

<!--:: if($ . text) for($.a of $.alice) for($.b of $.bob) -->
<p>${$.text} - alice likes: ${$.a} bob likes: ${$.b}</p>
<!--::-->

<!--::-->
<h2>world</h2>

<script type="module" id="DollarDotsCompile">
  import { compile } from "./DDCompile.js";
  compile(document.body, "./DD.js");
</script>

<script type="module">
  import { render, findRunnableTemplates } from "./DDRender.js";

  const state = Object.freeze({
    sunshine: "sunny sunshine",
    world: "beautiful world",
    text: "text",
    header: true,
    bob: ["red", "green", "blue"],
    alice: ["red", "green", "blue"],
  });

  //todo this needs to await the compile. How to ensure that this will run after the compile?
  //todo the sequence should ensure this? but it will not if the Compile is slowed down by something else.
  await new Promise(r => setTimeout(r, 100)); //todo hack
  for (let { start, id, end } of findRunnableTemplates(document.body))
    render(state, start, end, id);

</script>