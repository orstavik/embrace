<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Embrace Template Engine - Reverse Engineering & Tests</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-case {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }

        .test-case h3 {
            margin-top: 0;
        }

        .passed {
            color: green;
            font-weight: bold;
        }

        .failed {
            color: red;
            font-weight: bold;
        }

        pre {
            background: #f4f4f4;
            padding: 5px;
        }

        .test-class {
            color: red;
        }
    </style>
</head>

<body>
    <h1>Template Engine Capabilities Test</h1>

    <div id="app">
        <!--:: ; -->
        <!-- 1. Basic Variable Substitution -->
        <div class="test-case" id="test-basic">
            <h3>1. Basic Variable Substitution</h3>
            <p>Simple String: <span id="res-simple">${$.simple}</span></p>
            <p>Number: <span id="res-number">${$.number}</span></p>
        </div>

        <!-- 2. Nested Properties -->
        <div class="test-case" id="test-nested">
            <h3>2. Nested Properties</h3>
            <p>Object Property: <span id="res-nested">${$.obj.prop}</span></p>
            <p>Deep Property: <span id="res-deep">${$.obj.deep.val}</span></p>
        </div>

        <!-- 3. Expressions -->
        <div class="test-case" id="test-expressions">
            <h3>3. Expressions</h3>
            <p>Math (10 + 5): <span id="res-math">${$.math.a + $.math.b}</span></p>
            <p>Comparison (10 > 5): <span id="res-comp">${$.math.a > $.math.b}</span></p>
            <p>Ternary: <span id="res-ternary">${$.booleanTrue ? "Yes" : "No"}</span></p>
        </div>

        <!-- 4. Conditionals -->
        <div class="test-case" id="test-conditionals">
            <h3>4. Conditionals</h3>
            <!--:: if($.booleanTrue) -->
            <p id="res-if-true" class="test-class">This should be visible (True)</p>
            <!--::-->
            <!--:: if($.booleanFalse) -->
            <p id="res-if-false">This should NOT be visible (False)</p>
            <!--::-->
            <!--:: if($.math.a > 5) -->
            <p id="res-if-expr">This should be visible (Expression)</p>
            <!--::-->
        </div>

        <!-- 5. Loops -->
        <div class="test-case" id="test-loops">
            <h3>5. Loops</h3>
            <h4>Simple List</h4>
            <ul id="res-list">
                <!--:: for([$.i, $.item] of $.list.entries()) -->
                <li>${$.item} (Index: ${$.i})</li>
                <!--::-->
            </ul>

            <h4>Object List</h4>
            <ul id="res-obj-list">
                <!--:: for($.user of $.objectsList) -->
                <li>${$.user.name} - ${$.user.id}</li>
                <!--::-->
            </ul>
        </div>

        <!-- 6. Missing/Null -->
        <div class="test-case" id="test-missing">
            <h3>6. Missing/Null Values</h3>
            <p>Missing: "<span id="res-missing">${$.missingVar}</span>"</p>
            <p>Null: "<span id="res-null">${$.nullVal}</span>"</p>
        </div>

        <!-- 7. Dynamic Toggle -->
        <div class="test-case" id="test-toggle">
            <h3>7. Dynamic Toggle</h3>
            <button id="toggle-btn">Toggle Visibility</button>
            <!--:: if($.booleanToggle) -->
            <p id="res-toggle-text">Now you see me!</p>
            <!--::-->
        </div>
        <!--::-->
    </div>

    <script type="module" src="/src/DDauto.js"></script>
    <script type="module">
        import { renderUnder, getDefinitions } from "/src/DDRender.js";

        while (!Object.keys(getDefinitions()).length)
            await new Promise(requestAnimationFrame);

        const data = {
            "simple": "Hello World",
            "number": 42,
            "booleanTrue": true,
            "booleanFalse": false,
            "obj": {
                "prop": "nested property",
                "deep": {
                    "val": "deep value"
                }
            },
            "list": ["one", "two", "three"],
            "objectsList": [
                { "name": "Alice", "id": 1 },
                { "name": "Bob", "id": 2 }
            ],
            "nullVal": null,
            "undefinedVal": "undefined string",
            "math": {
                "a": 10,
                "b": 5
            },
            "htmlString": "<b>Bold</b>"
        };

        // Add a dynamic property
        data.booleanToggle = true;

        const app = document.getElementById("app");

        // Render
        renderUnder(app, data);

        // Handle toggle
        document.getElementById("toggle-btn")?.addEventListener("click", () => {
            data.booleanToggle = !data.booleanToggle;
            renderUnder(app, data);
            console.log("Toggled booleanToggle to:", data.booleanToggle);
        });

        console.log("Render complete");
    </script>
</body>

</html>