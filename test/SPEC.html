<div embrace="AppOriginal" something="${$.else}">
  <!-- <template> -->
  <h2>List of Series ("series" is an array? ${$.series instanceof Array})</h2>
  <ol>
    <!-- <template for="$serie of $.series"> -->
    <li>
      <h3>${$.serie.title} is the no. ${$.serie} in your play list.</h3>
      <ul>
        <!-- <template for="$season of $serie.seasons"> -->
        <li>
          <h4>{{$season.title}} is the no. {{$.$.season}} in series {{$serie.title}}.</h4>
          <!-- <template if="($.$.season % 2) === 0"> -->
          <ol>
            <!-- <template for="$episode of $season.episodes"> -->
            <!-- {{JSON.stringify($.$season, null, 2)}} -->
            <li>episode #{{##episode}}: {{$episode}} produced by {{$.producer}}.</li>
            <!-- </template> -->
          </ol>
          <!-- </template> -->
        </li>
        <!-- </template> -->
      </ul>
    </li>
    <!-- </template> -->
  </ol>
  <!-- </template> -->
</div>

<!-- twoWayPureFunctionExact1() vLeft and vRight-->

<div embrace="AppOriginal" something="{{$.else}}"></div>
<script>
  class EmbraceAppOriginal {
    static templates = {
      0: [`embrace="AppOriginal" something="{{$.else}}"`, `
  <h2>List of Series ("series" is an array? {{$.series instanceof Array}})</h2>
  <ol>
    <!-- <template for="$serie of $.series"> -->
    <li>
      <h3>{{$serie.title}} is the no. {{##serie}} in your play list.</h3>
      <ul>
        <!-- <template for="$season of $serie.seasons"> -->
        <li>
          <h4>{{$season.title}} is the no. {{##season}} in series {{$serie.title}}.</h4>
          <!-- <template if="(#season % 2) === 0"> -->
          <ol>
            <!-- <template for="  $episode of $season.episodes"> -->
            <!-- {{JSON.stringify(season, null, 2)}} -->
            <li>episode #{{##episode}}: {{$episode}} produced by {{$.producer}}.</li>
            <!-- </template> -->
          </ol>
          <!-- </template> -->
        </li>
        <!-- </template> -->
      </ul>
    </li>
    <!-- </template> -->
  </ol>
`],
    };
  }
</script>

<!-- twoWayPureFunctionExact2() vLeft and vRight -->

<div embrace="AppOriginal" something="{{$.else}}"></div>
<script>

  class EmbraceAppOriginal {
    //templates must be DAG.
    static templates = {
      0: [`embrace="AppOriginal" something="{{$.else}}"`, `
  <h2>List of Series ("$.series" is an array? {{$.series instanceof Array}})</h2>
  <ol>
    <!--embrace=1-->
  </ol>
`],
      1: [`<!--<template for="$serie of $.series"> -->`, `
    <li>
      <h3>{{$serie.title}} is the no. {{#serie}} in your play list.</h3>
      <ul>
        <!--embrace=2-->
      </ul>
    </li>
  `],
      2: [`<!--<template for="$season of $serie.seasons"> -->`, `
        <li>
          <h4>{{$season.title}} is the no. {{#season}} in series {{$serie.title}}.</h4>
          <!--embrace=3-->
        </li>
      `],
      3: [`<!--<template if="(#season % 2) === 0"> -->`,
        `<ol>
            <!--embrace=4-->
          </ol>
          `],
      4: [`<!--<template for="$episode of $season.episodes"> -->`,
        `<!-- {{JSON.stringify(season, null, 2)}} -->
            <li>episode #{{#episode}}: {{$episode}} produced by {{$.producer}}.</li>
            `],
    };
  }
</script>

<!-- twoWayPureFunctionExact3() vLeft and vRight -->

<div embrace="AppOriginal" something="{{$.else}}"></div>
<script>

  class EmbraceAppOriginal {
    //templates must be DAG.
    static templates = {
      0: [`embrace="AppOriginal" something="{{$.else}}"`],
      1: [`
  <h2>List of Series ("$.series" is an array? {{$.series instanceof Array}})</h2>
  <ol>
    <!-- for($serie of $.series) => embrace=2 --><!-- -->
  </ol>
`, ["$.else", "$.series", "$serie = $.series[]"]],
      2: [`<li>
      <h3>{{$serie.title}} is the no. {{#serie}} in your play list.</h3>
      <ul>
        <!-- for($season of $serie.seasons) => embrace=3 --><!-- -->
      </ul>
    </li>
`, ["$serie", "$season = $serie.seasons[]"]],
      3: [`<li>
          <h4>{{$season.title}} is the no. {{#season}} in series {{$serie.title}}.</h4>
          <!-- if((#season % 2) === 0) => embrace=4 --><!-- -->
        </li>
`, ["$season", "$season.title", "$serie.title", "$episode = $season.episodes[]"]],
      4: [`<ol>
            <!-- for ($episode of $season.episodes) => embrace=5 -->
          </ol>
          `, ["$season.episodes", 4]],
      5: [`<!-- {{JSON.stringify($season, null, 2)}} -->
            <li>episode #{{#episode}}: {{$episode}} produced by {{$.producer}}.</li>
            `, ["$season", "$episode", "$.producer"]],
    };
  }
</script>

<!-- twoWayPureFunctionExact3() vLeft and vRight -->
<!-- rule we can't have *any* properties names $ or starting with $ in the incoming data object. -->

<div embrace="AppOriginal" something="{{$.else}}"></div>
<script>

// function embraceLoop($, keyName, template, cb){
//   for(let x of []){
//     ...
//     const new$ = {...$};
//     new$[`${keyName}`] = x;
//     new$[`$_${keyName}`] = key ?? i;
//     new$[`$__${keyName}`] = i;
//     cb(new$, template);
//   }
// }

  class EmbraceAppOriginal {
    //templates must be DAG.
    static templates = {
      0: [`embrace="AppOriginal" something="{{$.else}}"`,
        ["$.else"],
        ["aA", [$ => `$.else`]]
      ],
      1: [`
  <h2 class="bob">List of Series ("$.series" is an array? {{$.series instanceof Array}})</h2>
  <ol>
    <!-- for($serie of $.series) => embrace=2 --><!-- -->
  </ol>
`,
        ["$.else", "$.series", "$serie = $.series[]"],
        ["weaTwewCcww", [
          ($,$$) => `List of Series ("$.series" is an array? ${$.series instanceof Array})`,
          ($,$$) => embraceLoop($, "$$.serie", templates, 2)  ]
        ]
      ],
      2: [`<li>
      <h3>{{$serie.title}} is the no. {{#serie}} in your play list.</h3>
      <ul>
        <!-- for($season of $serie.seasons) => embrace=3 --><!-- -->
      </ul>
    </li>
`,
        ["$serie", "$season = $serie.seasons[]"],
        ["eweTwewCcwww", [
          ($, node) => node.textContent = `${$.$serie.title} is the no. ${$.$_serie} in your play list.`,
          ($, node) => embraceLoop(node, "$season", templates[3], $)
        ]]],
      3: [`<li>
          <h4>{{$season.title}} is the no. {{#season}} in series {{$serie.title}}.</h4>
          <!-- if((#season % 2) === 0) => embrace=4 --><!-- -->
        </li>
`, ["$season", "$season.title", "$serie.title", "$episode = $season.episodes[]"]],
      4: [`<ol>
            <!-- for ($episode of $season.episodes) => embrace=5 -->
          </ol>
          `, ["$season.episodes", 4]],
      5: [`<!-- {{JSON.stringify($season, null, 2)}} -->
            <li>episode #{{#episode}}: {{$episode}} produced by {{$.producer}}.</li>
            `, ["$season", "$episode", "$.producer"]],
    };
  }
</script>







<script>
  class EmbraceAppOriginal {
    static templates = {
      0: [`something="{{$.else}}"`, `
  <h2>List of Series ("$.series" is an array? {{$.series instanceof Array}})</h2>
  <ol>
    <!--embrace=1-->
  </ol>
`],
      1: [`<!--<template for="$serie of $.series"> -->`, `
    <li>
      <h3>{{$serie.title}} is the no. {{#serie}} in your play list.</h3>
      <ul>
        <!--embrace=2-->
      </ul>
    </li>
  `],
      2: [`<!--<template for="$season of $serie.seasons"> -->`, `
        <li>
          <h4>{{$season.title}} is the no. {{#season}} in series {{$serie.title}}.</h4>
          <!--embrace=3-->
        </li>
      `],
      3: [`<!--<template if="(#season % 2) === 0"> -->`,
        `<ol>
            <!--embrace=4-->
          </ol>
          `],
      4: [`<!--<template for="$episode of $season.episodes"> -->`,
        `<!-- {{JSON.stringify(season, null, 2)}} -->
            <li>episode #{{#episode}}: {{$episode}} produced by {{$.producer}}.</li>
            `],
    };

  }
</script>

