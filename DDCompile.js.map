{"version":3,"file":"DDCompile.js","sources":["src/POJO.js","src/DD.js","src/DDCompile.js"],"sourcesContent":["function _maxWidth(txt, indent, maxWidth) {\n  const R = new RegExp(`((\\\\n(?:${indent})+)[\\\\s\\\\S]*?)([\\\\[{]\\\\n[\\\\s\\\\S]*?\\\\2[\\\\]}])`, \"g\");\n  const R2 = new RegExp(`\\\\n(${indent}*)`, \"g\");\n  let m;\n  while (m = R.exec(txt)) {\n    const [all, key, , value] = m;\n    const endOfKey = m.index + key.length;\n    const newTxt = value.replaceAll(R2, \" \");\n    if (newTxt.length < maxWidth) {\n      txt = txt.slice(0, endOfKey) + newTxt + txt.slice(m.index + all.length);\n      R.lastIndex = endOfKey + newTxt.length;\n    } else {\n      R.lastIndex = endOfKey;\n    }\n  }\n  return txt;\n}\nconst SimpleNamesInQuotes = /\"([\\p{ID_Start}_$][\\p{ID_Continue}$]*)\":|(\"(?:\\\\[\\s\\S]|[^\"\\\\])*\")/gu;\nfunction stringify(obj, replacer, indent, maxWidth) {\n  if (replacer && !(replacer instanceof Function))\n    throw new TypeError(\"replacer must be a function\");\n  if (typeof indent == \"number\")\n    indent = \" \".repeat(indent);\n  const FUNKY = crypto.randomUUID();\n  const FunkyRx = new RegExp(`\"${FUNKY}([\\\\s\\\\S]*?)${FUNKY}\"`, \"g\");\n  const doFunky = replacer ?\n    (k, v) => (v = replacer(k, v), v instanceof Function ? FUNKY + v + FUNKY : v) :\n    (k, v) => v instanceof Function ? FUNKY + v + FUNKY : v;\n  const jsTxt = JSON.stringify(obj, doFunky, indent)\n    .replaceAll(FunkyRx, (_, f) => f.replace(/\\\\\"/g, '\"').replace(/\\\\n/g, '\\n').replace(/\\\\\\\\/g, '\\\\'))\n    .replaceAll(SimpleNamesInQuotes, (_, n, q) => q || (n + \":\"));\n  return _maxWidth(jsTxt, indent, maxWidth);\n}\n\nfunction unsafeParse(txt) {\n  return Function(\"return (\" + txt + \")\").call(null);\n}\n\nexport default {\n  stringify,\n  unsafeParse,\n}","const dollarDots = {};\n\nfunction mapInnerDefs(innerHydras) {\n  const res = new Map();\n  for (let i = 0; i < innerHydras.length; i++) {\n    if (innerHydras[i].Def) {\n      res.set(innerHydras[i].Def, [[i]]);\n      for (let innerInnerDef of innerHydras[i].Def.innerDefs.keys()) {\n        const innerInnerDefPositions = res.get(innerInnerDef);\n        if (innerInnerDefPositions) {\n          const innerInnerDefPositionsFromOuterPointOfView = innerInnerDefPositions.map(pos => [i, ...pos]);\n          let myInnerInnerDefPositions = res.get(innerInnerDef);\n          myInnerInnerDefPositions ?\n            myInnerInnerDefPositions.push(...innerInnerDefPositionsFromOuterPointOfView) :\n            res.set(innerInnerDef, innerInnerDefPositionsFromOuterPointOfView);\n        }\n      }\n    }\n  }\n  return res;\n}\n\nexport function register(template) {\n  dollarDots[template.id] = template;\n  const el = document.createElement(\"template\");\n  el.innerHTML = template.templateString;\n  template.docFrag = el.content;\n  delete template.templateString;\n  template.innerHydras = template.innerHydras.map(({ id, path, hydra }) => ({\n    id,\n    path,\n    hydra,\n    Def: getDefinition(id),\n  }));\n  template.position = Object.keys(dollarDots).length;\n  template.innerDefs = mapInnerDefs(template.innerHydras);\n}\n\nexport function getDefinition(id) {\n  return dollarDots[id];\n}\n\nconst resolvePath = (root, path) => path.reduce((n, i) =>\n  typeof i == \"string\" ? n.getAttributeNode(i) : n.childNodes[i], root);\n\nexport function getInstance(Def) {\n  const root = Def.docFrag.cloneNode(true);\n  const start = root.firstChild;\n  const nodes = Def.innerHydras.map(({ path, Def }) => {\n    const start = resolvePath(root, path);\n    const end = Def ? start.nextSibling : undefined;\n    return { start, end };\n  });\n  const innerHydras = Def.innerHydras;\n  return { start, innerHydras, nodes };\n}\n\nexport function findEndComment(start) {\n  const commas = [];\n  for (let end = start.nextSibling, depth = 0; end; end = end.nextSibling)\n    if (end.nodeType === Node.COMMENT_NODE) {\n      const endTxt = end.nodeValue.trim();\n      if (!depth && endTxt == \"::\")\n        return { end, commas: [start, ...commas, end] };\n      if (!depth && endTxt == \"::,\")\n        commas.push(end);\n      if (endTxt == \"::\")\n        depth--;\n      else if (endTxt.startsWith(\":: \"))\n        depth++;\n    }\n}\n\nexport function* findDollarDots(node) {\n  const traverser = document.createTreeWalker(node, NodeFilter.SHOW_ALL, null, false);\n  for (let node; node = traverser.nextNode();) {\n    const txt = node.nodeValue?.trim();\n    if (node.nodeType === Node.COMMENT_NODE && txt.startsWith(\":: \")) {\n      const id = txt.match(/^::\\s+(id_[0-9a-f]{32})\\s*$/i)?.[1];\n      let { end, commas } = findEndComment(node) ?? {};\n      if (!end) { //implicit close at endOf siblings\n        end = document.createComment(\"::\");\n        node.parentNode.append(end);\n      }\n      const templ = { start: node, end, commas, id };\n      traverser.currentNode = templ.end;\n      yield templ;\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\n      for (let attr of node.attributes)\n        if (attr.value.indexOf(\"${\") >= 0)\n          yield { start: attr };\n    } else if (txt.indexOf(\"${\") >= 0)\n      yield { start: node };\n  }\n}\n\nexport function* findRunnableTemplates(root) {\n  for (let n of findDollarDots(root))\n    if (n.id)   //todo we need to retry not yet available templates\n      yield n;\n}","//assume correct js inside the ${...} and <!--:: ... -->\nimport POJO from \"./POJO.js\";\nimport { register, findDollarDots } from \"./DD.js\";\n\nfunction pathFunction(start) {\n  const res = [];\n  if (start instanceof Attr) {\n    res.push(start.name);\n    start = start.ownerElement;\n  }\n  for (let n = start; !(n instanceof Document || n instanceof DocumentFragment); n = n.parentNode)\n    res.unshift([...n.parentNode.childNodes].indexOf(n));\n  return res;\n}\n\n//runs recursively and discovers innerTemplates\nfunction _compile({ start, id, end }) {\n  const res = [];\n  const templEl = document.createElement(\"template\");\n  templEl.content.append(document.createComment(\"::,\"));\n  while (start.nextSibling != end)\n    templEl.content.append(start.nextSibling);\n\n  const innerHydras = [];\n  for (let inner of findDollarDots(templEl.content)) {\n    const path = pathFunction(inner.start);\n    if (inner.id)\n      innerHydras.push({ id: inner.id, path });\n    else if (!inner.end)\n      innerHydras.push({ path, hydra: Function(\"return \" + \"$ => `\" + inner.start.nodeValue + \"`\")() })\n    else {\n      const innerTemplates = _compile(inner);\n      innerHydras.push({ path, ...innerTemplates[0] });\n      res.push(...innerTemplates);\n    }\n  }\n\n  const templateString = templEl.innerHTML;\n  const hydra = Function(\"return \" + `($, $$) => {${start.nodeValue.slice(2).trim()} $$();}`)();\n  id = \"id_\" + crypto.randomUUID().replace(/-/g, \"\");\n  start.nodeValue = \":: \" + id;   //att!! mutates the start.nodeValue!!!\n\n  return [{ id, hydra, templateString, innerHydras }, ...res];\n}\n\nfunction templateToString(template) {\n  return POJO.stringify({\n    ...template,\n    innerHydras: template.innerHydras.map(({ id, path, hydra }) => ({ id, path, hydra })),\n  }, null, 2, 120);\n}\n\nfunction compile(rootNode) {\n  if (!(rootNode instanceof Node))\n    throw new Error(\"rootNode must be a DOM node\");\n  const res = [];\n  for (let n of findDollarDots(rootNode))\n    if (n.end && !n.id)\n      res.push(..._compile(n));\n  return res;\n}\n\nfunction compileString(txt) {\n  const tmpl = document.createElement(\"template\");\n  tmpl.innerHTML = txt;\n  return compile(tmpl.content);\n}\n\n(function autoCompile() {\n  const id = \"DollarDotsDefinition\";\n  if (document.getElementById(id))\n    return; //we have already setup the motherScript, then we don't autocompile\n  const hash = new URL(import.meta.url).hash?.slice(1);\n  if (!hash)\n    return;\n  const sp = Object.fromEntries(new URLSearchParams(hash));\n  const motherScript = document.getElementById(sp.id ?? \"DollarDotsCompile\");\n  if (!motherScript) //if there is no script to compile anymore, then we assume we have already run.\n    return;\n  if (!(motherScript instanceof HTMLScriptElement))\n    throw new Error(\"compileScript must be a <script> element\");\n  motherScript.type = \"module\";\n  motherScript.id = id;\n  const path = sp.dd ?? new URL(\"./DD6.js\", import.meta.url);\n  motherScript.textContent = `import { register } from \"${path}\";\\n\\n`;\n  const root = document.querySelector(sp.qs ?? \"body\");\n  const templates = compile(root);\n  for (let template of templates.reverse()) {\n    register(template);\n    motherScript.textContent += `register(${templateToString(template)});\\n`;\n  }\n})();\n\nexport {\n  compile,\n  compileString,\n}"],"names":[],"mappings":"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"}